<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Seasonal Tree Product Dose Calculator</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: system-ui, sans-serif; background:#f5f5f5; margin:0; }
    header { background:#0d6efd; color:#fff; padding:1rem 1.5rem; }
    main { max-width:1150px; margin:0 auto; padding:1.5rem; }
    .card { background:#fff; border-radius:12px; padding:1.25rem 1.5rem 1.5rem; box-shadow:0 10px 35px rgba(0,0,0,.05); }
    label { font-weight:600; display:block; margin-bottom:.25rem; }
    select,input { width:100%; padding:.45rem .55rem; border-radius:8px; border:1px solid #ddd; margin-bottom:.75rem; background:#fff; }
    .row { display:flex; gap:1rem; flex-wrap:wrap; }
    .col-4 { flex:1 1 220px; }
    .col-6 { flex:1 1 320px; }
    .tabs { display:flex; gap:.5rem; margin-top:1rem; margin-bottom:1rem; flex-wrap:wrap; }
    .tab-btn { border:1px solid #ddd; background:#fff; padding:.4rem .75rem; border-radius:999px; font-size:.8rem; cursor:pointer; }
    .tab-btn.active { background:#0d6efd; color:#fff; border-color:#0d6efd; }
    .panel { display:none; }
    .panel.active { display:block; }
    .results { background:#0d6efd0d; border:1px solid #0d6efd1f; border-radius:10px; padding:1rem 1.25rem; margin-top:1rem; }
    small { font-size:.7rem; color:#555; display:block; margin-top:-.2rem; margin-bottom:.5rem; }
    .disclaimer { font-size:.65rem; color:#888; margin-top:.65rem; }
    #useText, #ppeText { white-space:pre-line; }
    .label-box { background:#f0f4ff; border:1px solid #d7e1ff; padding:1rem; border-radius:8px; }
    .label-box a { display:inline-block; margin-top:.5rem; color:#0d6efd; font-weight:600; text-decoration:none; }
    .steps { margin-top:.75rem; }
    .steps ol { padding-left:1.1rem; }
    .steps li { margin-bottom:.35rem; }
    #productImage { max-width:180px; max-height:180px; object-fit:contain; border-radius:10px; background:#fff; border:1px solid #eee; padding:.4rem; margin-top:.75rem; }
  </style>
</head>
<body>
<header><h1>Seasonal Tree Product Dose Calculator</h1></header>
<main>
  <div class="card">
    <div class="row">
      <div class="col-4">
        <label for="season">Season</label>
        <select id="season">
          <option value="">-- pick a season --</option>
          <option value="winter">Winter</option>
          <option value="spring">Spring</option>
          <option value="summer">Summer</option>
          <option value="fall">Fall</option>
        </select>
      </div>
      <div class="col-6">
        <label for="product">Product</label>
        <select id="product" disabled>
          <option value="">-- pick a season first --</option>
        </select>
      </div>
    </div>

    <div class="tabs" id="tabs" style="display:none">
      <button class="tab-btn active" data-tab="use">Use</button>
      <button class="tab-btn" data-tab="ppe">PPE & Application</button>
      <button class="tab-btn" data-tab="dose">Dose Calculator</button>
      <button class="tab-btn" data-tab="label">Label</button>
    </div>

    <!-- USE PANEL -->
    <div id="panel-use" class="panel active">
      <p id="useText">Pick a season, then a product.</p>
      <img id="productImage" alt="Product image" style="display:none" />
    </div>

    <!-- PPE PANEL -->
    <div id="panel-ppe" class="panel">
      <p id="ppeText">Select a product to see PPE and application notes.</p>
      <div id="ppeMethodWrap" style="display:none; max-width:320px; margin-top:.75rem;">
        <label for="ppeMethod">Application method</label>
        <select id="ppeMethod"></select>
      </div>
      <div id="ppeSteps" class="steps"></div>
    </div>

    <!-- DOSE PANEL -->
    <div id="panel-dose" class="panel">
      <div id="cambistatInputs" class="row" style="display:none">
        <div class="col-6">
          <label for="species">Tree species (Cambistat)</label>
          <select id="species"></select>
        </div>
        <div class="col-4">
          <label for="dbhCambistat">DBH (inches)</label>
          <input id="dbhCambistat" type="number" min="4" max="47" step="1" value="10" />
          <small>Cambistat table is 4â€“47 inches</small>
        </div>
      </div>

      <div id="dbhInputs" class="row" style="display:none">
        <div class="col-4">
          <label for="dbh">DBH (inches)</label>
          <input id="dbh" type="number" min="1" step="0.1" value="10" />
        </div>
      </div>

      <div id="methodWrap" class="row" style="display:none">
        <div class="col-4">
          <label for="method">Application method</label>
          <select id="method"></select>
        </div>
      </div>

      <div id="pestWrap" class="row" style="display:none">
        <div class="col-6">
          <label for="pest">Target / rate</label>
          <select id="pest"></select>
        </div>
      </div>

      <div id="sprayInputs" class="row" style="display:none">
        <div class="col-4">
          <label for="sprayVol">Spray / drench volume (gallons)</label>
          <input id="sprayVol" type="number" min="1" step="0.5" value="25" />
        </div>
      </div>

      <div id="results" class="results" style="display:none">
        <h3>Dose</h3>
        <p id="doseText"></p>
        <p id="waterText"></p>
        <p id="totalText"></p>
        <p class="disclaimer">
          Always follow the current specimen label. This tool summarizes rates and PPE and is not a substitute for the label.
        </p>
      </div>
    </div>

    <!-- LABEL PANEL -->
    <div id="panel-label" class="panel">
      <div class="label-box" id="labelBox">
        Select a product and its label link will appear here.
      </div>
    </div>
  </div>
</main>

<script>
/* seasons â†’ products (with your new ones) */
const seasonProducts = {
  winter: ["cambistat","reliant","alamo","moistureaide","trimtect","sightline"],
  spring: ["xytect2f","xytect10","transtect70","transtectInfusible","proxite","bifenamite2sc","abamectin015","scrimmage","diamid","junction","biorush","reliant","mectinite","lepitect","hortoil","upstargold","bacastat","verdurmn"],
  summer: ["myclotect","transtect70","transtectInfusible","lepitect","mectinite","moistureaide","onmark","scrimmage","bifenamite2sc","proxite","upstargold","bifenxts","hortoil","sightline"],
  fall: ["cambistat","xytect2f","alamo","trimtect","junction","moistureaide","reliant","sightline"]
};

/* product images */
const productImages = {
  "cambistat": "images/RES-Cambistat-Gallon__52689.jpg",
  "abamectin015": "images/RES-Abamectin-015__71348.jpg",
  "alamo": "images/1202-alamo__16320.jpg",
  "bifenamite2sc": "images/bifenamite-sc__52622.jpg",
  "biorush": "images/RES-Diehard-Bio-Rush-Plus-3-0-11__26758.jpg",
  "diamid": "images/RES-Diamid-TO__74522.jpg",
  "junction": "images/RES-Junction__25991.jpg",
  "lepitect": "images/RES-Lepitect__26494.jpg",
  "mectinite": "images/RES-Mectinite-Bottle__92199.jpg",
  "moistureaide": "images/RES-moistureaide__62233.jpg",
  "myclotect": "images/RES-Myclotect-qt__42906.jpg",
  "onmark": "images/RES-onmark__01662.jpg",
  "proxite": "images/RES-Proxite-Bottle__57978.jpg",
  "scrimmage": "images/scrimmage__58783.jpg",
  "transtect70": "images/RES-Transtect-70WSP__45645.jpg",
  "transtectInfusible": "images/Transtect_Infus__33428.jpg",
  "trimtect": "images/RES-Trimtect-2-5-Gallon__84360.jpg",
  "xytect2f": "images/RES-Xytect-2F-Gallon__22159.jpg",
  "xytect10": "images/RES-Xytect-10-Purple__96021.jpg",
  "reliant": "images/rtsa-reliant__29291.jpg",
  "hortoil": "images/RES-Hort-Oil__41445.jpg",
  "upstargold": "images/224-up-star-gold-gal__76211.jpg",
  "bifenxts": "images/RES-Bifen-XTS-Quart__96760.jpg",
  "bacastat": "images/RES-Bacastat-2023__62248.jpg",
  "sightline": "images/RES-Sightline-Quart__37814.jpg",
  "verdurmn": "images/RES-Verdur-Mn-2023__87706.jpg"
};

/* cambistat dose table */
const cambistatData = {
  "4":{"A":{"product":17,"water":185},"B":{"product":23,"water":250},"C":{"product":42,"water":460},"D":{"product":46,"water":510},"E":{"product":50,"water":550},"F":{"product":67,"water":735}},
  "5":{"A":{"product":21,"water":230},"B":{"product":28,"water":310},"C":{"product":52,"water":575},"D":{"product":57,"water":630},"E":{"product":63,"water":690},"F":{"product":83,"water":920}},
  "6":{"A":{"product":25,"water":275},"B":{"product":33,"water":370},"C":{"product":63,"water":690},"D":{"product":69,"water":760},"E":{"product":75,"water":825},"F":{"product":100,"water":1100}},
  "7":{"A":{"product":44,"water":480},"B":{"product":58,"water":645},"C":{"product":73,"water":805},"D":{"product":80,"water":885},"E":{"product":88,"water":965},"F":{"product":117,"water":1285}},
  "8":{"A":{"product":50,"water":550},"B":{"product":67,"water":735},"C":{"product":83,"water":920},"D":{"product":92,"water":1000},"E":{"product":100,"water":1100},"F":{"product":133,"water":1470}},
  "9":{"A":{"product":56,"water":620},"B":{"product":75,"water":825},"C":{"product":94,"water":1030},"D":{"product":103,"water":1135},"E":{"product":113,"water":1240},"F":{"product":150,"water":1650}},
  "10":{"A":{"product":63,"water":690},"B":{"product":83,"water":920},"C":{"product":104,"water":1145},"D":{"product":115,"water":1260},"E":{"product":125,"water":1375},"F":{"product":167,"water":1835}},
  "11":{"A":{"product":69,"water":755},"B":{"product":92,"water":1010},"C":{"product":115,"water":1260},"D":{"product":126,"water":1390},"E":{"product":138,"water":1515},"F":{"product":183,"water":2020}},
  "12":{"A":{"product":75,"water":825},"B":{"product":100,"water":1100},"C":{"product":125,"water":1375},"D":{"product":138,"water":1515},"E":{"product":150,"water":1650},"F":{"product":200,"water":2200}},
  "13":{"A":{"product":81,"water":900},"B":{"product":108,"water":1190},"C":{"product":135,"water":1490},"D":{"product":149,"water":1640},"E":{"product":163,"water":1790},"F":{"product":217,"water":2385}},
  "14":{"A":{"product":88,"water":965},"B":{"product":117,"water":1285},"C":{"product":146,"water":1605},"D":{"product":160,"water":1765},"E":{"product":175,"water":1925},"F":{"product":233,"water":2570}},
  "15":{"A":{"product":94,"water":1030},"B":{"product":125,"water":1375},"C":{"product":156,"water":1720},"D":{"product":172,"water":1895},"E":{"product":188,"water":2065},"F":{"product":250,"water":2750}},
  "16":{"A":{"product":100,"water":1100},"B":{"product":133,"water":1470},"C":{"product":167,"water":1835},"D":{"product":183,"water":2020},"E":{"product":200,"water":2200},"F":{"product":267,"water":2935}},
  "17":{"A":{"product":106,"water":1170},"B":{"product":142,"water":1560},"C":{"product":177,"water":1950},"D":{"product":195,"water":2145},"E":{"product":213,"water":2340},"F":{"product":283,"water":3120}},
  "18":{"A":{"product":113,"water":1240},"B":{"product":150,"water":1650},"C":{"product":188,"water":2065},"D":{"product":206,"water":2270},"E":{"product":225,"water":2475},"F":{"product":300,"water":3300}},
  "19":{"A":{"product":119,"water":1310},"B":{"product":158,"water":1745},"C":{"product":198,"water":2177},"D":{"product":218,"water":2395},"E":{"product":238,"water":2615},"F":{"product":317,"water":3485}},
  "20":{"A":{"product":125,"water":1375},"B":{"product":167,"water":1835},"C":{"product":208,"water":2290},"D":{"product":229,"water":2520},"E":{"product":250,"water":2750},"F":{"product":333,"water":3670}},
  "21":{"A":{"product":131,"water":1445},"B":{"product":175,"water":1925},"C":{"product":219,"water":2410},"D":{"product":241,"water":2650},"E":{"product":263,"water":2890},"F":{"product":350,"water":3850}},
  "22":{"A":{"product":138,"water":1515},"B":{"product":183,"water":2020},"C":{"product":229,"water":2520},"D":{"product":252,"water":2775},"E":{"product":275,"water":3025},"F":{"product":367,"water":4035}},
  "23":{"A":{"product":144,"water":1580},"B":{"product":192,"water":2110},"C":{"product":240,"water":2635},"D":{"product":264,"water":2900},"E":{"product":288,"water":3165},"F":{"product":383,"water":4220}},
  "24":{"A":{"product":150,"water":1650},"B":{"product":200,"water":2200},"C":{"product":250,"water":2750},"D":{"product":275,"water":3025},"E":{"product":300,"water":3300},"F":{"product":400,"water":4400}},
  "25":{"A":{"product":156,"water":1720},"B":{"product":208,"water":2295},"C":{"product":260,"water":2865},"D":{"product":287,"water":3150},"E":{"product":313,"water":3440},"F":{"product":417,"water":4585}},
  "26":{"A":{"product":162,"water":1787},"B":{"product":217,"water":2385},"C":{"product":271,"water":2980},"D":{"product":298,"water":3277},"E":{"product":325,"water":3575},"F":{"product":433,"water":4765}},
  "27":{"A":{"product":169,"water":1855},"B":{"product":225,"water":2475},"C":{"product":281,"water":3095},"D":{"product":310,"water":3400},"E":{"product":338,"water":3715},"F":{"product":450,"water":4950}},
  "28":{"A":{"product":175,"water":1925},"B":{"product":233,"water":2570},"C":{"product":292,"water":3210},"D":{"product":321,"water":3530},"E":{"product":350,"water":3850},"F":{"product":467,"water":5135}},
  "29":{"A":{"product":181,"water":1995},"B":{"product":242,"water":2660},"C":{"product":302,"water":3320},"D":{"product":332,"water":3660},"E":{"product":363,"water":3990},"F":{"product":483,"water":5320}},
  "30":{"A":{"product":188,"water":2060},"B":{"product":250,"water":2750},"C":{"product":313,"water":3440},"D":{"product":344,"water":3780},"E":{"product":375,"water":4125},"F":{"product":500,"water":5500}},
  "31":{"A":{"product":194,"water":2130},"B":{"product":258,"water":2840},"C":{"product":323,"water":3550},"D":{"product":355,"water":3910},"E":{"product":388,"water":4265},"F":{"product":517,"water":5685}},
  "32":{"A":{"product":200,"water":2200},"B":{"product":267,"water":2930},"C":{"product":333,"water":3670},"D":{"product":367,"water":4035},"E":{"product":400,"water":4400},"F":{"product":533,"water":5870}},
  "33":{"A":{"product":206,"water":2270},"B":{"product":275,"water":3025},"C":{"product":345,"water":3780},"D":{"product":378,"water":4160},"E":{"product":413,"water":4540},"F":{"product":550,"water":6050}},
  "34":{"A":{"product":213,"water":2340},"B":{"product":283,"water":3120},"C":{"product":354,"water":3900},"D":{"product":390,"water":4285},"E":{"product":425,"water":4675},"F":{"product":567,"water":6235}},
  "35":{"A":{"product":219,"water":2405},"B":{"product":292,"water":3210},"C":{"product":365,"water":4010},"D":{"product":401,"water":4410},"E":{"product":438,"water":4810},"F":{"product":583,"water":6415}},
  "36":{"A":{"product":225,"water":2475},"B":{"product":300,"water":3300},"C":{"product":375,"water":4125},"D":{"product":413,"water":4540},"E":{"product":450,"water":4950},"F":{"product":600,"water":6600}},
  "37":{"A":{"product":231,"water":2545},"B":{"product":308,"water":3390},"C":{"product":386,"water":4240},"D":{"product":424,"water":4664},"E":{"product":463,"water":5090},"F":{"product":617,"water":6780}},
  "38":{"A":{"product":238,"water":2610},"B":{"product":317,"water":3480},"C":{"product":396,"water":4355},"D":{"product":435,"water":4790},"E":{"product":475,"water":5225},"F":{"product":633,"water":6970}},
  "39":{"A":{"product":244,"water":2680},"B":{"product":325,"water":3575},"C":{"product":406,"water":4470},"D":{"product":447,"water":4915},"E":{"product":488,"water":5365},"F":{"product":650,"water":7150}},
  "40":{"A":{"product":250,"water":2750},"B":{"product":333,"water":3670},"C":{"product":417,"water":4585},"D":{"product":458,"water":5040},"E":{"product":500,"water":5500},"F":{"product":667,"water":7335}},
  "41":{"A":{"product":256,"water":2820},"B":{"product":342,"water":3760},"C":{"product":427,"water":4700},"D":{"product":470,"water":5168},"E":{"product":513,"water":5640},"F":{"product":683,"water":7520}},
  "42":{"A":{"product":263,"water":2890},"B":{"product":350,"water":3850},"C":{"product":438,"water":4815},"D":{"product":481,"water":5295},"E":{"product":525,"water":5775},"F":{"product":700,"water":7700}},
  "43":{"A":{"product":269,"water":2955},"B":{"product":358,"water":3940},"C":{"product":448,"water":4930},"D":{"product":493,"water":5420},"E":{"product":538,"water":5915},"F":{"product":717,"water":7885}},
  "44":{"A":{"product":275,"water":3025},"B":{"product":367,"water":4035},"C":{"product":458,"water":5040},"D":{"product":504,"water":5545},"E":{"product":550,"water":6050},"F":{"product":733,"water":8065}},
  "45":{"A":{"product":281,"water":3095},"B":{"product":375,"water":4125},"C":{"product":469,"water":5155},"D":{"product":516,"water":5670},"E":{"product":563,"water":6190},"F":{"product":750,"water":8250}},
  "46":{"A":{"product":288,"water":3160},"B":{"product":383,"water":4220},"C":{"product":479,"water":5270},"D":{"product":527,"water":5800},"E":{"product":575,"water":6325},"F":{"product":767,"water":8435}},
  "47":{"A":{"product":294,"water":3230},"B":{"product":392,"water":4310},"C":{"product":490,"water":5385},"D":{"product":539,"water":5924},"E":{"product":588,"water":6463},"F":{"product":783,"water":8615}}
};

/* species map from your table */
const speciesToCategory = {
  "Acacia":"F","Ailanthus":"D","Alder":"F","Anaqua":"E","Arborvitae":"F","Ash":"F","Aspen":"F","Australian Bottle":"C","Australian Pine":"A","Bald Cypress":"F","Banyan - Ficus":"F","Basswood, American":"A","Baytree":"E","Beech":"E","Birch":"F","Bischofia":"F","Black Gum / Tupelo":"B","Black Olive":"F","Bottlebrush":"F","Boxelder":"A","Buckeye":"D","Buttonwood":"F","California Pepper":"C","Camphor":"E","Catalpa":"E","Cedar â€“ Deodora":"E","Cedar - all others":"F","Cherry - Black":"F","Cherry - Ornamental":"E","Cherry - Laurel":"E","Chinaberry":"E","Chinese Pistache":"E","Cottonwood*":"F","Crabapple":"F","Crape Myrtle":"B","Cryptomeria":"F","Cypress":"B","Ebony - Texas":"F","Elm - Cedar":"B","Elm - Chinese/Lacebark":"A","Elm - Siberian":"A","Elm - (all others)":"B","Eucalyptus":"F","Ficus":"F","Fir":"F","Ginkgo":"F","Gumbo Limbo":"F","Hackberry":"F","Hawthorn":"C","Hickory":"E","Holly - American":"E","Holly â€“ Nellie Stevens":"E","Holly - Yaupon":"B","Horsechestnut":"C","Huisache":"E","Ironwood / Hornbeam":"D","Jacaranda":"F","Japanese Tree Lilac":"E","Juniper":"F","Katsura - Japanese":"A","Larch":"F","Laurel":"F","Leyland Cypress":"F","Linden":"A","Locust - Black":"F","Locust - Honey":"E","Lombardy Poplar":"F","Lysiloma":"F","Magnolia":"F","Mahogany":"F","Maple - Amur":"B","Maple - Bigleaf":"D","Maple - Japanese (caution)**":"A","Maple - Norway":"B","Maple - Red":"B","Maple - Silver":"D","Maple - Sugar":"B","Melaleuca":"F","Mesquite":"F","Mimosa":"E","Mountain Ash":"B","Mulberry":"F","Oak â€“ Black":"E","Oak â€“ Blackjack":"E","Oak â€“ Bur":"D","Oak - Laurel":"F","Oak - Live (<10â€)":"B","Oak - Live (>10â€)":"E","Oak - Pin":"E","Oak - Post":"E","Oak - Red":"E","Oak - Sand Shinnery":"E","Oak - Scarlet":"E","Oak - Shumard":"E","Oak - Valley":"F","Oak - Water":"E","Oak - White":"D","Oak - Willow":"E","Olive - Black":"F","Olive - European":"E","Olive - Russian":"E","Orchid Tree - Hong Kong":"C","Osage Orange":"F","Palms":"F","Paloverde":"E","Paulownia":"E","Pear - Ornamental":"F","Pecan":"E","Persimmon":"C","Photinia":"E","Pines*":"F","Plum - Ornamental":"E","Poinciana":"F","Raintree - Golden":"F","Redcedar - Eastern":"F","Redwood":"F","Rosewood / Tipuana":"C","Russian Olive":"E","Saltcedar":"F","Sassafrass":"E","Sea Grape":"E","Soapberry":"E","Spruce*":"F","Sugarberry / So. Hackberry":"F","Sumac - African":"E","Sycamore":"F","Tabebuia":"F","Tallow - Chinese":"F","Tallowwood":"F","Tamarisk":"F","Tepeguaje":"E","Tulip / Yellow Poplar":"F","Tupelo / Black Gum":"B","Walnut":"E","Waxmyrtle - Pacific":"F","Willow":"F","Xylosma":"C","Yellow Poplar / Tulip":"F","Yew":"F","Zelkova":"B"
};

/* product configs */
const productConfig = {
  /* Cambistat */
  cambistat: {
    name: "Cambistat",
    showCambistat: true,
    labelUrl: "labels/Cambistat%20Label.pdf",
    use: "Use: Growth regulator â€” use species category Aâ€“F + DBH to find exact dose and water.",
    ppe: "PPE:\nâ€¢ Long-sleeved shirt and long pants\nâ€¢ Chemical-resistant gloves\nâ€¢ Shoes plus socks\nâ€¢ Eye/face protection if splash hazard",
    applicationSteps: {
      "Soil drench": [
        "1. Measure DBH and find dose (mL product + mL water) in the Cambistat table.",
        "2. Add the product to a bucket or tank with some water in it.",
        "3. Add the rest of the water to reach the table volume; mix well.",
        "4. Pour as a band around the root flare.",
        "5. Light irrigation if soil is dry.",
        "6. Rinse equipment."
      ],
      "Soil injection": [
        "1. Measure DBH and look up the table dose.",
        "2. Put product + water into your injection tank.",
        "3. Make 6â€“12 injection points evenly around the root flare.",
        "4. Inject 2â€“8 in from the trunk at low pressure.",
        "5. Continue until all solution is injected.",
        "6. Rinse injection lines."
      ]
    }
  },

  /* Xytect 2F */
  xytect2f: {
    name: "Xytect 2F",
    showDBH: true,
    showMethods: true,
    labelUrl: "labels/Xytect%202F%20Label.pdf",
    methods: ["Soil injection","Soil drench"],
    pests: [
      {id:"standard", label:"Standard labeled insects â€“ 0.15 fl oz/in DBH", rateFlOz:0.15},
      {id:"heavy", label:"Higher pressure â€“ 0.3 fl oz/in DBH", rateFlOz:0.3},
      {id:"max", label:"Do not exceed label max â€“ 0.4 fl oz/in DBH", rateFlOz:0.4}
    ],
    use: "Use: Systemic imidacloprid for scales, aphids, adelgids, some borers.",
    ppe: "PPE:\nâ€¢ Long sleeves, long pants\nâ€¢ Chemical-resistant gloves\nâ€¢ Shoes plus socks",
    applicationSteps: {
      "Soil injection": [
        "1. Measure DBH and calculate product (fl oz) from chosen rate.",
        "2. Dilute in enough water to make injections easy.",
        "3. Make injection holes 2â€“8 in from trunk, evenly spaced.",
            "4. Inject at low pressure.",
        "5. Apply full volume around the tree.",
        "6. Do not exceed annual max rate."
      ],
      "Soil drench": [
        "1. Measure DBH and calculate dose.",
        "2. Add product to a bucket with at least 1â€“2 gal of water.",
        "3. Pour slowly in a band around the base.",
        "4. Avoid runoff/puddling.",
        "5. Rinse container and obey REI."
      ]
    }
  },

  /* Xytect 10 Injection */
  xytect10: {
    name: "Xytect 10% (injection)",
    showDBH: true,
    showMethods: true,
    labelUrl: "labels/Xytect%2010_%20Insecticide%20Label.pdf",
    methods: ["Trunk injection"],
    pests: [
      {id:"soft", label:"Soft-bodied pests (lower band)"},
      {id:"borer", label:"Borers / EAB (upper band)"}
    ],
    use: "Use: High concentration imidacloprid for trunk injection when soil/pour not possible.",
    ppe: "PPE:\nâ€¢ Long sleeves, long pants\nâ€¢ Chemical-resistant gloves\nâ€¢ Eye protection",
    applicationSteps: {
      "Trunk injection": [
        "1. Measure DBH and select the appropriate dose.",
        "2. Expose root flare if needed.",
        "3. Mark injection sites evenly (every 4â€“6 in circumference).",
        "4. Drill per device instructions.",
        "5. Let the tree take up solution at low pressure.",
        "6. Remove equipment and clean."
      ]
    }
  },

  /* Transtect 70WSP */
  transtect70: {
    name: "Transtect 70WSP",
    showDBH: true,
    showMethods: true,
    labelUrl: "labels/Transtect%20Label.pdf",
    methods: ["Soil drench","Soil injection","Bark spray (label)"],
    pests: [{id:"general", label:"General labeled insects (per packet chart)", ratePackets:1}],
    use: "Use: Dinotefuran, fast uptake, flexible applications.",
    ppe: "PPE:\nâ€¢ Long sleeves, long pants\nâ€¢ Chemical-resistant gloves\nâ€¢ Shoes plus socks",
    applicationSteps: {
      "Soil drench": [
        "1. Determine packets needed by DBH.",
        "2. Dissolve packet(s) fully in water.",
        "3. Pour around root flare.",
        "4. Avoid runoff.",
        "5. Rinse equipment."
      ],
      "Soil injection": [
        "1. Dissolve packet(s) in tank.",
        "2. Make several injection points around tree.",
        "3. Inject at low pressure into upper root zone.",
        "4. Apply full volume.",
        "5. Clean tank/lines."
      ],
      "Bark spray (label)": [
        "1. Mix packet(s) in water at label dilution.",
        "2. Spray trunk/bark to wet.",
        "3. Avoid off-target.",
        "4. Let dry and obey REI."
      ]
    }
  },

  /* Transtect Infusible */
  transtectInfusible: {
    name: "Transtect Infusible",
    showDBH: true,
    showMethods: true,
    labelUrl: "labels/TranstectInfusibleLabel.pdf",
    methods: ["Trunk injection"],
    use: "Use: Injectable dinotefuran.",
    ppe: "PPE:\nâ€¢ Long sleeves, long pants\nâ€¢ Chemical-resistant gloves\nâ€¢ Eye/face protection",
    applicationSteps: {
      "Trunk injection": [
        "1. Measure DBH and calculate total mL.",
        "2. Set up injection system.",
        "3. Place injection sites evenly around root flare.",
        "4. Inject at device pressure.",
        "5. Continue until dose is delivered.",
        "6. Rinse and dispose per label."
      ]
    }
  },

  /* Trimtect */
  trimtect: {
    name: "Trimtect",
    showDBH: true,
    showMethods: true,
    labelUrl: "labels/Trimtect%20Label.pdf",
    methods: ["Basal/soil drench","Soil injection"],
    use: "Use: Tree/shrub growth regulator.",
    ppe: "PPE:\nâ€¢ Long sleeves, long pants\nâ€¢ Chemical-resistant gloves\nâ€¢ Shoes plus socks",
    applicationSteps: {
      "Basal/soil drench": [
        "1. Measure DBH and determine mL needed.",
        "2. Mix Trimtect in water.",
        "3. Apply slowly around base.",
        "4. Keep off hardscape.",
        "5. Rinse container."
      ],
      "Soil injection": [
        "1. Measure DBH and calculate dose.",
        "2. Put Trimtect + water in injection tank.",
        "3. Make multiple injections around root flare.",
        "4. Inject at low pressure.",
        "5. Continue until entire volume is placed."
      ]
    }
  },

  /* Reliant */
  reliant: {
    name: "Reliant",
    showDBH: true,
    showMethods: true,
    labelUrl: "labels/Reliant%20Label.pdf",
    methods: ["Trunk injection","Soil drench"],
    pests: [
      {id:"disease", label:"Label disease rate â€“ 10 mL/in, dilute 1 L/in", rateMlPerIn:10, waterLPerIn:1}
    ],
    use: "Use: Phosphite systemic for some tree diseases.",
    ppe: "PPE:\nâ€¢ Long sleeves, long pants\nâ€¢ Chemical-resistant gloves\nâ€¢ Eye protection",
    applicationSteps: {
      "Trunk injection": [
        "1. Measure DBH and multiply by label mL/in.",
        "2. Dilute to about 1 L per inch.",
        "3. Drill injection holes around root flare.",
        "4. Connect injection equipment and deliver solution.",
        "5. Plug/close holes if directed.",
        "6. Clean equipment."
      ],
      "Soil drench": [
        "1. Mix Reliant in water to label dilution.",
        "2. Pour evenly around tree base.",
        "3. Avoid runoff.",
        "4. Repeat only at labeled intervals."
      ]
    }
  },

  /* Proxite */
  proxite: {
    name: "Proxite",
    showSpray: true,
    labelUrl: "labels/Proxite%20Label.pdf",
    pests: [
      {id:"ornLow", label:"Ornamentals â€“ 8 fl oz / 100 gal", rateFlOzPer100: 8},
      {id:"ornHigh", label:"Heavy â€“ 16 fl oz / 100 gal", rateFlOzPer100: 16}
    ],
    use: "Use: IGR for certain insect stages on ornamentals.",
    ppe: "PPE:\nâ€¢ Long sleeves, long pants\nâ€¢ Chemical-resistant gloves\nâ€¢ Shoes plus socks",
    applicationSteps: {
      "Spray": [
        "1. Add water to spray tank to 1/2.",
        "2. Add Proxite at labeled rate.",
        "3. Agitate and top off.",
        "4. Spray to thorough coverage.",
        "5. Respect label REI."
      ]
    }
  },

  /* Myclotect */
  myclotect: {
    name: "Myclotect",
    showSpray: true,
    labelUrl: "labels/Myclotect%20label-1.pdf",
    pests: [
      {id:"foliar", label:"Foliar diseases â€“ 6 fl oz / 100 gal", rateFlOzPer100: 6},
      {id:"higher", label:"Heavier disease â€“ 12 fl oz / 100 gal", rateFlOzPer100: 12}
    ],
    use: "Use: Fungicide for ornamental foliar diseases.",
    ppe: "PPE:\nâ€¢ Long sleeves, long pants\nâ€¢ Chemical-resistant gloves\nâ€¢ Eye protection",
    applicationSteps: {
      "Spray": [
        "1. Fill tank 1/2 with water.",
        "2. Add Myclotect at desired rate.",
        "3. Agitate and top off.",
        "4. Spray foliage to cover.",
        "5. Follow re-application and REI."
      ]
    }
  },

  /* Onmark */
  onmark: {
    name: "Onmark Herbicide",
    showSpray: true,
    labelUrl: "labels/Onmark%20Herbicide%20Label.pdf",
    pests: [
      {id:"1pct", label:"1% solution", percent:1},
      {id:"2pct", label:"2% solution", percent:2}
    ],
    use: "Use: Directed herbicide on labeled brush/weeds.",
    ppe: "PPE:\nâ€¢ Long sleeves, long pants\nâ€¢ Chemical-resistant gloves\nâ€¢ Eye protection\nâ€¢ Shoes plus socks",
    applicationSteps: {
      "Spray": [
        "1. Decide final spray volume.",
        "2. Add enough Onmark to make 1â€“2% solution.",
        "3. Fill remainder with water, agitate.",
        "4. Spray target plants to wet.",
        "5. Triple-rinse equipment."
      ]
    }
  },

  /* Bifenamite 2SC */
  bifenamite2sc: {
    name: "Bifenamite 2SC",
    showSpray: true,
    labelUrl: "labels/Bifenamite%202SC%20Label.pdf",
    pests: [
      {id:"mitesLow", label:"Mites â€“ 8 fl oz / 100 gal", rateFlOzPer100: 8},
      {id:"mitesHigh", label:"Mites (heavy) â€“ 16 fl oz / 100 gal", rateFlOzPer100: 16}
    ],
    use: "Use: Miticide for ornamental mites.",
    ppe: "PPE:\nâ€¢ Long sleeves, long pants\nâ€¢ Chemical-resistant gloves\nâ€¢ Shoes plus socks",
    applicationSteps: {
      "Spray": [
        "1. Add water to tank, start agitation.",
        "2. Add Bifenamite 2SC at labeled rate.",
        "3. Top off with water.",
        "4. Spray to thorough coverage.",
        "5. Observe REI."
      ]
    }
  },

  /* BIORUSH */
  biorush: {
    name: "Biorush Plus 3-0-11",
    showSpray: true,
    labelUrl: "labels/BIORUSH%20PLUS%203-0-11%20Specimen%20Label.pdf",
    use: "Use: Nutritional/soil amendment â€” often 1 lb per 50 gal.",
    ppe: "PPE:\nâ€¢ Long sleeves, long pants\nâ€¢ Gloves when handling dry material\nâ€¢ Shoes plus socks",
    applicationSteps: {
      "Spray": [
        "1. Measure correct weight of Biorush.",
        "2. Add to tank with water while agitating.",
        "3. Apply evenly.",
        "4. Rinse equipment."
      ]
    }
  },

  /* Diamid */
  diamid: {
    name: "Diamid",
    showSpray: true,
    labelUrl: "labels/Diamid%20Label.pdf",
    pests: [
      {id:"orn", label:"Ornamentals â€“ 8 fl oz / 100 gal", rateFlOzPer100: 8}
    ],
    use: "Use: Insecticide on ornamentals.",
    ppe: "PPE:\nâ€¢ Long sleeves, long pants\nâ€¢ Chemical-resistant gloves\nâ€¢ Shoes plus socks",
    applicationSteps: {
      "Spray": [
        "1. Fill spray tank 1/2.",
        "2. Add Diamid at labeled rate.",
        "3. Agitate and top off.",
        "4. Spray to uniform coverage.",
        "5. Follow REI."
      ]
    }
  },

  /* Junction */
  junction: {
    name: "Junction DF",
    showSpray: true,
    labelUrl: "labels/Junction_Speciman_Label.pdf",
    use: "Use: Copper + mancozeb fungicide/bactericide.",
    ppe: "PPE:\nâ€¢ Long sleeves, long pants\nâ€¢ Chemical-resistant gloves\nâ€¢ Eye protection\nâ€¢ Shoes plus socks",
    applicationSteps: {
      "Spray": [
        "1. Add water to tank.",
        "2. Add Junction DF slowly while agitating.",
        "3. Keep agitation on.",
        "4. Spray to cover foliage.",
        "5. Observe REI and copper restrictions."
      ]
    }
  },

  /* Lepitect Infusible */
  lepitect: {
    name: "Lepitect Infusible",
    showDBH: true,
    showMethods: true,
    labelUrl: "labels/Lepitect%20Infusible%20Specimen%20Label.pdf",
    methods: ["Trunk injection"],
    use: "Use: Injection acephate for leaf feeders.",
    ppe: "PPE:\nâ€¢ Long sleeves, long pants\nâ€¢ Chemical-resistant gloves\nâ€¢ Eye/face protection",
    applicationSteps: {
      "Trunk injection": [
        "1. Measure DBH to find total mL.",
        "2. Prepare injection solution.",
        "3. Make injection sites evenly spaced.",
        "4. Inject at low pressure.",
        "5. Clean equipment."
      ]
    }
  },

  /* Mectinite */
  mectinite: {
    name: "Mectinite",
    showDBH: true,
    showMethods: true,
    labelUrl: "labels/Mectinite%20Label.pdf",
    methods: ["Trunk injection"],
    use: "Use: Emamectin benzoate injection for borers / EAB.",
    ppe: "PPE:\nâ€¢ Long sleeves, long pants\nâ€¢ Chemical-resistant gloves\nâ€¢ Eye protection",
    applicationSteps: {
      "Trunk injection": [
        "1. Measure DBH and find mL per inch.",
        "2. Prepare solution.",
        "3. Drill/place injection sites around flare.",
        "4. Inject slowly.",
        "5. Rinse lines."
      ]
    }
  },

  /* MoistureAide */
  moistureaide: {
    name: "MoistureAide",
    showDBH: true,
    showMethods: true,
    labelUrl: "labels/MoistureAide%20Label.pdf",
    methods: ["Soil drench","Soil injection"],
    use: "Use: Wetting/conditioning around root zone.",
    ppe: "PPE:\nâ€¢ Long sleeves, long pants\nâ€¢ Chemical-resistant gloves\nâ€¢ Shoes plus socks",
    applicationSteps: {
      "Soil drench": [
        "1. Mix MoistureAide in water.",
        "2. Pour evenly over root zone.",
        "3. Avoid runoff.",
        "4. Rinse equipment."
      ],
      "Soil injection": [
        "1. Mix product in injection tank.",
        "2. Make multiple injection points.",
        "3. Inject at label depth/pressure.",
        "4. Clean equipment."
      ]
    }
  },

  /* Scrimmage */
  scrimmage: {
    name: "Scrimmage 03F",
    showSpray: true,
    labelUrl: "labels/Scrimmage.pdf",
    pests: [
      {id:"withPesticide", label:"With insecticide/fungicide â€“ 16 fl oz/100 gal", rateFlOzPer100: 16},
      {id:"withHerbicide", label:"With herbicide â€“ 32 fl oz/100 gal", rateFlOzPer100: 32}
    ],
    use: "Use: Adjuvant to improve spray coverage (only if main label allows).",
    ppe: "PPE:\nâ€¢ Long sleeves, long pants\nâ€¢ Chemical-resistant gloves\nâ€¢ Shoes plus socks",
    applicationSteps: {
      "Spray": [
        "1. Start with water and agitation.",
        "2. Add Scrimmage 03F at adjuvant rate.",
        "3. Add the pesticide/herbicide.",
        "4. Keep agitating and spray.",
        "5. Rinse tank and lines."
      ]
    }
  },

  /* Abamectin 0.15 */
  abamectin015: {
    name: "Abamectin 0.15 Select",
    showSpray: true,
    labelUrl: "labels/Abamectin%20Label.pdf",
    pests: [
      {id:"ornLow", label:"Ornamentals â€“ 8 fl oz/100 gal", rateFlOzPer100: 8},
      {id:"ornHigh", label:"Higher pressure â€“ 16 fl oz/100 gal", rateFlOzPer100: 16}
    ],
    use: "Use: Miticide/insecticide on ornamentals.",
    ppe: "PPE:\nâ€¢ Long sleeves, long pants\nâ€¢ Chemical-resistant gloves\nâ€¢ Shoes plus socks",
    applicationSteps: {
      "Spray": [
        "1. Fill tank 1/2 with water.",
        "2. Add Abamectin at labeled rate.",
        "3. Top off with water and agitate.",
        "4. Spray to good coverage.",
        "5. Obey REI."
      ]
    }
  },

  /* Alamo */
  alamo: {
    name: "Alamo (propiconazole)",
    showDBH: true,
    showMethods: true,
    labelUrl: "labels/Alamo%20Label.pdf",
    methods: ["Flare-root injection"],
    pests: [
      {id:"oakWilt", label:"Oak wilt / preventive â€“ 10 mL/in DBH (dilute up to 1 L/in)", rateMlPerIn:10, waterLPerIn:1},
      {id:"oakWiltHigh", label:"Oak wilt / therapeutic â€“ 20 mL/in DBH (dilute up to 1 L/in)", rateMlPerIn:20, waterLPerIn:1},
      {id:"dutchElm", label:"Dutch elm disease â€“ 10 mL/in DBH", rateMlPerIn:10, waterLPerIn:1}
    ],
    use: "Use: Systemic fungicide by flare-root injection for oak wilt / DED.",
    ppe: "PPE:\nâ€¢ Long sleeves, long pants\nâ€¢ Chemical-resistant gloves\nâ€¢ Eye/face protection\nâ€¢ Shoes plus socks",
    applicationSteps: {
      "Flare-root injection": [
        "1. Measure DBH and calculate mL and dilution water.",
        "2. Expose root flare.",
        "3. Mark injection sites evenly.",
        "4. Drill to depth specified.",
        "5. Inject solution at low pressure.",
        "6. Remove equipment, plug if needed, record treatment."
      ]
    }
  },

  /* Hort Oil (new) */
  hortoil: {
    name: "Hort Oil",
    showSpray: true,
    labelUrl: "",
    pests: [
      {id:"2pct", label:"2% solution (heavy scale)", percent:2},
      {id:"1pct", label:"1% solution (maintenance)", percent:1}
    ],
    use: "Use: horticultural oil for labeled insects/mites/scales on ornamentals.",
    ppe: "PPE:\nâ€¢ Long sleeves, long pants\nâ€¢ Chemical-resistant gloves\nâ€¢ Shoes plus socks\nâ€¢ Eye protection if splash",
    applicationSteps: {
      "Spray": [
        "1. Fill sprayer 1/2 with water.",
        "2. Add Hort Oil to make the selected % solution.",
        "3. Top off while agitating.",
        "4. Spray to full coverage.",
        "5. Avoid drought-stressed or very hot conditions."
      ]
    }
  },

  /* UP-Star Gold (new) */
  upstargold: {
    name: "UP-Star Gold",
    showSpray: true,
    labelUrl: "labels/UP-Star%20Gold%20Label.pdf",
    pests: [
      {id:"ornLow", label:"Ornamentals â€“ 0.25% spray", percent:0.25},
      {id:"ornHigh", label:"Ornamentals â€“ 0.5% spray", percent:0.5}
    ],
    use: "Use: bifenthrin insecticide for ornamental pests.",
    ppe: "PPE:\nâ€¢ Long sleeves, long pants\nâ€¢ Chemical-resistant gloves\nâ€¢ Shoes plus socks\nâ€¢ Eye/face protection if splash",
    applicationSteps: {
      "Spray": [
        "1. Determine final spray volume.",
        "2. Add UP-Star Gold for the % needed.",
        "3. Agitate and fill to final volume.",
        "4. Spray to uniform coverage.",
        "5. Keep people/pets out until dry."
      ]
    }
  },

  /* Bifen XTS (new) */
  bifenxts: {
    name: "Bifen XTS",
    showSpray: true,
    labelUrl: "",
    pests: [
      {id:"orn", label:"Ornamentals â€“ 1 fl oz / 10 gal (example)", rateFlOzPer100:10}
    ],
    use: "Use: high-load bifenthrin for labeled insects (add your label when you have it).",
    ppe: "PPE:\nâ€¢ Long sleeves, long pants\nâ€¢ Chemical-resistant gloves\nâ€¢ Shoes plus socks",
    applicationSteps: {
      "Spray": [
        "1. Fill tank 1/2 with water.",
        "2. Add Bifen XTS at target rate.",
        "3. Top off with water.",
        "4. Spray to thorough coverage.",
        "5. Rinse tank and nozzles."
      ]
    }
  },

  /* Bacastat (new) */
  bacastat: {
    name: "Bacastat",
    showSpray: true,
    labelUrl: "",
    pests: [
      {id:"foliar", label:"Foliar â€“ 2 fl oz / gal (example)", rateFlOzPer100:200}
    ],
    use: "Use: tree/plant health product â€” adjust to your program.",
    ppe: "PPE:\nâ€¢ Long sleeves, long pants\nâ€¢ Gloves\nâ€¢ Shoes plus socks",
    applicationSteps: {
      "Spray": [
        "1. Mix Bacastat in water to the desired program rate.",
        "2. Agitate until uniform.",
        "3. Apply to foliage/target area.",
        "4. Do not overapply."
      ]
    }
  },

  /* Sightline (new) */
  sightline: {
    name: "Sightline Herbicide",
    showSpray: true,
    labelUrl: "labels/Sightline%20Label.pdf",
    pests: [
      {id:"1qt100", label:"1 qt / 100 gal (light brush)", rateFlOzPer100:32},
      {id:"2qt100", label:"2 qt / 100 gal (heavier brush)", rateFlOzPer100:64}
    ],
    use: "Use: brush/broadleaf herbicide â€” see label for exact species.",
    ppe: "PPE:\nâ€¢ Coveralls\nâ€¢ Chemical-resistant gloves\nâ€¢ Shoes plus socks\nâ€¢ Protective eyewear",
    applicationSteps: {
      "Spray": [
        "1. Fill spray tank 1/2 with water.",
        "2. Add Sightline at 1â€“2 qt per 100 gal.",
        "3. Add surfactant if label allows.",
        "4. Agitate and fill to final volume.",
        "5. Spray brush to wet, no heavy runoff.",
        "6. Keep people out until dry."
      ]
    }
  },

  /* Verdur Mn (new) */
  verdurmn: {
    name: "Verdur Mn",
    showSpray: true,
    labelUrl: "",
    pests: [
      {id:"nutrient", label:"Nutritional â€“ 1 gal / 100 gal", rateFlOzPer100:128}
    ],
    use: "Use: manganese/nutritional supplement for trees/ornamentals.",
    ppe: "PPE:\nâ€¢ Long sleeves, long pants\nâ€¢ Gloves\nâ€¢ Shoes plus socks",
    applicationSteps: {
      "Spray": [
        "1. Put water in tank.",
        "2. Add Verdur Mn at nutrient rate.",
        "3. Agitate and fill.",
        "4. Apply to soil or foliage.",
        "5. Rinse tank."
      ]
    }
  }
};

/* helpers */
function showSection(id, show){ document.getElementById(id).style.display = show ? "" : "none"; }
function gallonsToMl(g){ return g*3785.41; }
function lbToGrams(lb){ return lb*453.592; }

/* populate species */
function populateSpecies(){
  const sel=document.getElementById("species");
  sel.innerHTML="";
  Object.keys(speciesToCategory).sort().forEach(name=>{
    const opt=document.createElement("option");
    opt.value=name;
    opt.textContent=name;
    sel.appendChild(opt);
  });
}
populateSpecies();

/* season change */
document.getElementById("season").addEventListener("change", ()=>{
  const season = document.getElementById("season").value;
  const prodSel = document.getElementById("product");
  prodSel.innerHTML = "";
  if (!season || !seasonProducts[season]) {
    prodSel.disabled = true;
    prodSel.innerHTML = '<option value="">-- pick a season first --</option>';
    document.getElementById("tabs").style.display = "none";
    return;
  }
  seasonProducts[season].forEach(pid=>{
    const cfg = productConfig[pid];
    if (cfg){
      const opt = document.createElement("option");
      opt.value = pid;
      opt.textContent = cfg.name;
      prodSel.appendChild(opt);
    }
  });
  prodSel.disabled = false;
  document.getElementById("tabs").style.display = "";
  updateProductUI();
});

/* product change */
document.getElementById("product").addEventListener("change", updateProductUI);

/* tabs */
document.querySelectorAll(".tab-btn").forEach(btn=>{
  btn.addEventListener("click",()=>{
    document.querySelectorAll(".tab-btn").forEach(b=>b.classList.remove("active"));
    document.querySelectorAll(".panel").forEach(p=>p.classList.remove("active"));
    btn.classList.add("active");
    document.getElementById(`panel-${btn.dataset.tab}`).classList.add("active");
  });
});

function updateProductUI(){
  const product = document.getElementById("product").value;
  if (!product) return;
  const cfg = productConfig[product];

  // USE text
  document.getElementById("useText").textContent = cfg.use || "See label.";

  // image
  const imgEl = document.getElementById("productImage");
  const imgSrc = productImages[product];
  if (imgSrc) {
    imgEl.src = imgSrc;
    imgEl.style.display = "";
  } else {
    imgEl.style.display = "none";
  }

  // PPE
  document.getElementById("ppeText").textContent = cfg.ppe || "See label.";

  // PPE methods
  const ppeMethodWrap = document.getElementById("ppeMethodWrap");
  const ppeMethod = document.getElementById("ppeMethod");
  ppeMethod.innerHTML = "";
  if (cfg.applicationSteps && Object.keys(cfg.applicationSteps).length) {
    Object.keys(cfg.applicationSteps).forEach(m=>{
      const o=document.createElement("option");
      o.value=m; o.textContent=m;
      ppeMethod.appendChild(o);
    });
    ppeMethodWrap.style.display = "";
    renderPPESteps(product, ppeMethod.value);
  } else {
    ppeMethodWrap.style.display = "none";
    document.getElementById("ppeSteps").innerHTML = "";
  }

  // label
  const labelBox = document.getElementById("labelBox");
  if (cfg.labelUrl) {
    labelBox.innerHTML = `This product has a label.<br><a href="${cfg.labelUrl}" target="_blank" rel="noopener noreferrer">ðŸ“„ View label PDF</a>`;
  } else {
    labelBox.textContent = "Label not available in this project yet.";
  }

  // reset dose UI
  showSection("cambistatInputs", false);
  showSection("dbhInputs", false);
  showSection("methodWrap", false);
  showSection("pestWrap", false);
  showSection("sprayInputs", false);
  showSection("results", false);

  if (cfg.showCambistat) {
    showSection("cambistatInputs", true);
    calcCambistat();
    return;
  }
  if (cfg.showDBH) showSection("dbhInputs", true);
  if (cfg.showMethods) {
    const mSel = document.getElementById("method");
    mSel.innerHTML = "";
    (cfg.methods || []).forEach(m=>{
      const o=document.createElement("option");
      o.value=m; o.textContent=m;
      mSel.appendChild(o);
    });
    showSection("methodWrap", true);
  }
  if (cfg.pests) {
    const pSel = document.getElementById("pest");
    pSel.innerHTML = "";
    (cfg.pests || []).forEach(p=>{
      const o=document.createElement("option");
      o.value=p.id; o.textContent=p.label;
      pSel.appendChild(o);
    });
    showSection("pestWrap", true);
  }
  if (cfg.showSpray) {
    showSection("sprayInputs", true);
  }

  computeCurrentProduct();
}

/* PPE steps renderer */
function renderPPESteps(productId, methodName){
  const cfg = productConfig[productId];
  const stepsBox = document.getElementById("ppeSteps");
  stepsBox.innerHTML = "";
  if (!cfg || !cfg.applicationSteps) return;
  const steps = cfg.applicationSteps[methodName];
  if (!steps) return;
  const ol = document.createElement("ol");
  steps.forEach(s=>{
    const li=document.createElement("li");
    li.textContent = s;
    ol.appendChild(li);
  });
  stepsBox.appendChild(ol);
  const note = document.createElement("p");
  note.style.fontSize = ".65rem";
  note.style.color = "#777";
  note.textContent = "Confirm drill bit size, pressure, number of injection ports, and re-treatment intervals on the actual label you uploaded.";
  stepsBox.appendChild(note);
}

/* cambistat calc */
function calcCambistat(){
  const species = document.getElementById("species").value;
  const dbh = parseInt(document.getElementById("dbhCambistat").value, 10);
  const doseText = document.getElementById("doseText");
  const waterText = document.getElementById("waterText");
  const totalText = document.getElementById("totalText");

  if (isNaN(dbh) || dbh < 4 || dbh > 47) {
    showSection("results", true);
    doseText.textContent = "DBH must be between 4 and 47 in for Cambistat table.";
    waterText.textContent = "";
    totalText.textContent = "";
    return;
  }

  let category;
  if (species === "Oak - Live (<10â€)") {
    category = dbh < 10 ? "B" : "E";
  } else if (species === "Oak - Live (>10â€)") {
    category = dbh > 10 ? "E" : "B";
  } else {
    category = speciesToCategory[species] || "F";
  }

  const row = cambistatData[dbh];
  const cell = row[category];
  showSection("results", true);
  doseText.textContent = `Product: ${cell.product} mL Cambistat (Category ${category})`;
  waterText.textContent = `Water: ${cell.water} mL`;
  totalText.textContent = `Total: ${cell.product + cell.water} mL`;
}

/* main calculator */
function computeCurrentProduct(){
  const product = document.getElementById("product").value;
  const cfg = productConfig[product];
  if (!cfg) return;

  const doseText = document.getElementById("doseText");
  const waterText = document.getElementById("waterText");
  const totalText = document.getElementById("totalText");
  showSection("results", true);

  // 1) Cambistat already done above
  if (cfg.showCambistat) return;

  // 2) Xytect 2F and Xytect 10 (soil/trunk)
  if (product === "xytect2f" || product === "xytect10") {
    const dbh = parseFloat(document.getElementById("dbh").value || "0");
    const pestId = document.getElementById("pest").value;
    const method = document.getElementById("method").value;
    const rateObj = (cfg.pests || [])[0];
    const chosen = (cfg.pests || []).find(p=>p.id===pestId) || rateObj;
    const mlPerIn = (chosen.rateFlOz || 0.15) * 29.5735;
    const productMl = mlPerIn * dbh;
    let waterMl;

    if (method === "Soil injection") {
      const gals = Math.max(1, dbh * 1);
      waterMl = gallonsToMl(gals);
      waterText.textContent = `Water: ${Math.round(waterMl)} mL (â‰ˆ ${gals.toFixed(1)} gal)`;
    } else if (method === "Soil drench") {
      const gals = 2;
      waterMl = gallonsToMl(gals);
      waterText.textContent = `Water: ${Math.round(waterMl)} mL (example 2 gal drench)`;
    } else { // trunk injection case on xytect10
      waterMl = 0;
      waterText.textContent = `Water: per injection device / label.`;
    }

    doseText.textContent = `Product: ${Math.round(productMl)} mL ${cfg.name} at ${(chosen.rateFlOz || 0.15)} fl oz/in Ã— ${dbh} in`;
    totalText.textContent = waterMl ? `Total: ${Math.round(productMl + waterMl)} mL` : `Total: ${Math.round(productMl)} mL (inject undiluted per label)`;
    return;
  }

  // 3) Alamo and Reliant (mL/in Ã— DBH, dilute L/in)
  if (product === "alamo" || product === "reliant") {
    const dbh = parseFloat(document.getElementById("dbh").value || "0");
    const pestId = document.getElementById("pest").value;
    const chosen = (cfg.pests || [])[0];
    const p = (cfg.pests || []).find(x=>x.id===pestId) || chosen;
    const productMl = p.rateMlPerIn * dbh;
    const waterMl = p.waterLPerIn * dbh * 1000;
    doseText.textContent = `Product: ${Math.round(productMl)} mL ${cfg.name} (${p.rateMlPerIn} mL/in Ã— ${dbh} in)`;
    waterText.textContent = `Water: up to ${Math.round(waterMl)} mL (â‰ˆ ${(waterMl/1000).toFixed(1)} L)`;
    totalText.textContent = `Apply by flare-root injection per label.`;
    return;
  }

  // 4) Transtect 70 (packets)
  if (product === "transtect70") {
    const dbh = parseFloat(document.getElementById("dbh").value || "0");
    const method = document.getElementById("method").value;
    const packets = Math.ceil(dbh / 17);
    doseText.textContent = `Product: ${packets} packet(s) Transtect 70 WSP for ${dbh} in DBH.`;
    if (method === "Bark spray (label)") {
      waterText.textContent = `Water: enough to wet bark (â‰ˆ1â€“2 gal total).`;
      totalText.textContent = `Spray to runoff.`;
    } else {
      const gals = Math.max(2, dbh * 0.25);
      const waterMl = gallonsToMl(gals);
      waterText.textContent = `Water: ${Math.round(waterMl)} mL (â‰ˆ ${gals.toFixed(1)} gal)`;
      totalText.textContent = `Apply around root zone / injection sites.`;
    }
    return;
  }

  // 5) Injection-only products (Transtect Infusible, Lepitect Infusible, Mectinite)
  if (product === "transtectInfusible" || product === "lepitect" || product === "mectinite") {
    const dbh = parseFloat(document.getElementById("dbh").value || "0");
    let perIn;
    if (product === "transtectInfusible") perIn = dbh < 12 ? 2 : (dbh < 24 ? 4 : 6);
    if (product === "lepitect")           perIn = dbh < 12 ? 4 : (dbh < 24 ? 6 : 8);
    if (product === "mectinite")          perIn = dbh < 12 ? 4 : (dbh < 24 ? 8 : 10);
    const productMl = perIn * dbh;
    doseText.textContent = `Product: ${Math.round(productMl)} mL ${cfg.name} (${perIn} mL/in Ã— ${dbh} in).`;
    waterText.textContent = `Water: per injection device / label (enough to deliver).`;
    totalText.textContent = `Inject evenly around root flare.`;
    return;
  }

  // 6) Trimtect
  if (product === "trimtect") {
    const dbh = parseFloat(document.getElementById("dbh").value || "0");
    const method = document.getElementById("method").value;
    const productMl = 3 * dbh; // placeholder
    let waterMl;
    if (method === "Soil injection") {
      const gals = Math.max(1.5, dbh * 0.25);
      waterMl = gallonsToMl(gals);
      waterText.textContent = `Water: ${Math.round(waterMl)} mL (â‰ˆ ${gals.toFixed(1)} gal)`;
    } else {
      const gals = 1.5;
      waterMl = gallonsToMl(gals);
      waterText.textContent = `Water: ${Math.round(waterMl)} mL (example drench volume)`;
    }
    doseText.textContent = `Product: ${Math.round(productMl)} mL Trimtect (3 mL/in Ã— ${dbh} in)`;
    totalText.textContent = `Total: ${Math.round(productMl + waterMl)} mL`;
    return;
  }

  // 7) MoistureAide
  if (product === "moistureaide") {
    const dbh = parseFloat(document.getElementById("dbh").value || "0");
    const method = document.getElementById("method").value;
    const flOzPerIn = 6;
    const productMl = flOzPerIn * 29.5735 * dbh;
    if (method === "Soil injection") {
      const gals = 5 * dbh;
      const waterMl = gallonsToMl(gals);
      doseText.textContent = `Product: ${Math.round(productMl)} mL MoistureAide (${flOzPerIn} fl oz/in Ã— ${dbh} in).`;
      waterText.textContent = `Water: ${Math.round(waterMl)} mL (â‰ˆ ${gals.toFixed(1)} gal)`;
      totalText.textContent = `Total: ${Math.round(productMl + waterMl)} mL`;
    } else {
      const gals = 2;
      const waterMl = gallonsToMl(gals);
      doseText.textContent = `Product: ${Math.round(productMl)} mL MoistureAide.`;
      waterText.textContent = `Water: ${Math.round(waterMl)} mL (example drench).`;
      totalText.textContent = `Total: ${Math.round(productMl + waterMl)} mL`;
    }
    return;
  }

  // 8) Spray-only products (most of the rest, including new ones)
  if (cfg.showSpray && !cfg.showDBH && !cfg.showMethods) {
    const sprayGal = parseFloat(document.getElementById("sprayVol").value || "0");
    const pestId = document.getElementById("pest").value;
    const chosen = (cfg.pests || [])[0];
    const p = (cfg.pests || []).find(x=>x.id===pestId) || chosen;

    // percent style (hortoil, onmark, upstargold)
    if (p && typeof p.percent === "number") {
      const totalMl = gallonsToMl(sprayGal);
      const productMl = totalMl * (p.percent/100);
      doseText.textContent = `Product: ${Math.round(productMl)} mL ${cfg.name} for ${sprayGal} gal at ${p.percent}%`;
      waterText.textContent = `Water: to ${sprayGal} gal total.`;
      totalText.textContent = `Apply to full coverage.`;
      return;
    }

    // Biorush handled here? it has rateFlOzPer100 â€” fine.
    const rate = (p && p.rateFlOzPer100) ? p.rateFlOzPer100 : 8;
    const neededFlOz = rate * (sprayGal / 100);
    const productMl = neededFlOz * 29.5735;
    doseText.textContent = `Product: ${Math.round(productMl)} mL ${cfg.name} for ${sprayGal} gal at ${rate} fl oz/100 gal.`;
    waterText.textContent = `Water: to ${sprayGal} gal total spray.`;
    totalText.textContent = `Apply with good coverage.`;
    return;
  }

  // 9) fallback
  doseText.textContent = "Calculator for this product not fully defined here.";
  waterText.textContent = "";
  totalText.textContent = "";
}

/* live listeners */
document.getElementById("species").addEventListener("change", calcCambistat);
document.getElementById("dbhCambistat").addEventListener("input", calcCambistat);
document.getElementById("dbh").addEventListener("input", computeCurrentProduct);
document.getElementById("method").addEventListener("change", computeCurrentProduct);
document.getElementById("pest").addEventListener("change", computeCurrentProduct);
document.getElementById("sprayVol").addEventListener("input", computeCurrentProduct);
document.getElementById("ppeMethod").addEventListener("change", ()=>{
  const product = document.getElementById("product").value;
  const method = document.getElementById("ppeMethod").value;
  renderPPESteps(product, method);
});
</script>
</body>
</html>
